import "dotenv/config";
import mongoose from "mongoose";
import PlantTemplate from "../models/PlantTemplate.js";
import User from "../models/User.js";

const templates = [
  {
    template_name: "Rau ƒÉn l√° c∆° b·∫£n",
    plant_group: "leaf_vegetable",
    group_description:
      "Template cho c√°c lo·∫°i rau ƒÉn l√° nh∆∞ x√† l√°ch, rau mu·ªëng, c·∫£i xanh c√≥ chu k·ª≥ ng·∫Øn 30-45 ng√†y",
    plant_examples: [
      "X√† l√°ch",
      "Rau mu·ªëng",
      "C·∫£i xanh",
      "Rau d·ªÅn",
      "C·∫£i b√≥ x√¥i",
    ],
    stages: [
      {
        stage_number: 1,
        name: "N·∫£y m·∫ßm",
        description: "H·∫°t n·∫£y m·∫ßm, m·∫ßm v∆∞∆°n l√™n kh·ªèi ƒë·∫•t",
        day_start: 1,
        day_end: 7,
        stage_image:
          "https://images.unsplash.com/photo-1466692476868-aef1dfb1e735?w=400",
        autogenerated_tasks: [
          {
            task_name: "Gi·ªØ ·∫©m ƒë·∫•t",
            description: "Phun s∆∞∆°ng 2 l·∫ßn/ng√†y s√°ng v√† chi·ªÅu ƒë·ªÉ gi·ªØ ·∫©m",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "Ki·ªÉm tra nhi·ªát ƒë·ªô",
            description: "ƒê·∫£m b·∫£o nhi·ªát ƒë·ªô 20-25¬∞C",
            frequency: "daily",
            priority: "medium",
          },
        ],
        observation_required: [
          {
            key: "has_sprout",
            label: "ƒê√£ n·∫£y m·∫ßm?",
            description: "M·∫ßm cao kho·∫£ng 1-2cm, c√≥ 2 l√° m·∫ßm",
          },
        ],
      },
      {
        stage_number: 2,
        name: "Ra l√° th·∫≠t",
        description: "L√° th·∫≠t ƒë·∫ßu ti√™n xu·∫•t hi·ªán",
        day_start: 8,
        day_end: 14,
        stage_image:
          "https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc",
            description: "T∆∞·ªõi 1 l·∫ßn/ng√†y v√†o bu·ªïi s√°ng",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "Ki·ªÉm tra s√¢u b·ªánh",
            description: "Quan s√°t l√° c√≥ b·ªã s√¢u ƒÉn kh√¥ng",
            frequency: "every_2_days",
            priority: "medium",
          },
        ],
        observation_required: [
          {
            key: "has_true_leaf",
            label: "ƒê√£ c√≥ l√° th·∫≠t?",
            description: "2-3 l√° th·∫≠t ƒë·∫ßu ti√™n, kh√°c v·ªõi l√° m·∫ßm",
          },
        ],
      },
      {
        stage_number: 3,
        name: "Sinh tr∆∞·ªüng m·∫°nh",
        description: "C√¢y ph√°t tri·ªÉn nhanh, tƒÉng chi·ªÅu cao v√† s·ªë l√°",
        day_start: 15,
        day_end: 30,
        stage_image:
          "https://images.unsplash.com/photo-1592495989226-03f88104f8cc?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc",
            description: "T∆∞·ªõi ƒë·ªÅu ƒë·∫∑n h·∫±ng ng√†y",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "B√≥n ph√¢n",
            description: "B√≥n ph√¢n h·ªØu c∆° lo√£ng",
            frequency: "weekly",
            priority: "medium",
          },
          {
            task_name: "T·ªâa l√° gi√†",
            description: "C·∫Øt b·ªè l√° gi√† ph√≠a d∆∞·ªõi",
            frequency: "weekly",
            priority: "low",
          },
        ],
        observation_required: [
          {
            key: "strong_growth",
            label: "C√¢y ph√°t tri·ªÉn kh·ªèe?",
            description: "Nhi·ªÅu l√° xanh t·ªët, th√¢n c√¢y ch·∫Øc kh·ªèe",
          },
        ],
      },
      {
        stage_number: 4,
        name: "Thu ho·∫°ch",
        description: "C√¢y ƒë√£ tr∆∞·ªüng th√†nh, s·∫µn s√†ng thu ho·∫°ch",
        day_start: 31,
        day_end: 45,
        stage_image:
          "https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=400",
        autogenerated_tasks: [
          {
            task_name: "Thu ho·∫°ch",
            description: "C·∫Øt l√° t·ª´ ngo√†i v√†o trong",
            frequency: "every_2_days",
            priority: "high",
          },
          {
            task_name: "V·ªá sinh ch·∫≠u",
            description: "D·ªçn d·∫πp l√° √∫a, r√°c",
            frequency: "every_3_days",
            priority: "low",
          },
        ],
        observation_required: [
          {
            key: "ready_harvest",
            label: "S·∫µn s√†ng thu ho·∫°ch?",
            description: "L√° ƒë·ªß l·ªõn, xanh t·ªët, kh√¥ng b·ªã s√¢u b·ªánh",
          },
        ],
      },
    ],
    rules: {
      safe_delay_days: 3,
      auto_skip: true,
      warning_days: 1,
    },
    status: "active",
  },
  {
    template_name: "C√¢y c·ªß ng·∫Øn ng√†y",
    plant_group: "root_vegetable",
    group_description:
      "Template cho c·ªß c·∫£i, c√† r·ªët baby v√† c√°c lo·∫°i c·ªß ng·∫Øn ng√†y 45-60 ng√†y",
    plant_examples: ["C·ªß c·∫£i tr·∫Øng", "C√† r·ªët baby", "C·ªß d·ªÅn"],
    stages: [
      {
        stage_number: 1,
        name: "N·∫£y m·∫ßm",
        description: "H·∫°t n·∫£y m·∫ßm",
        day_start: 1,
        day_end: 10,
        stage_image:
          "https://images.unsplash.com/photo-1589923188900-85dae523342b?w=400",
        autogenerated_tasks: [
          {
            task_name: "Gi·ªØ ·∫©m",
            description: "Phun s∆∞∆°ng ƒë·ªÅu ƒë·∫∑n",
            frequency: "daily",
            priority: "high",
          },
        ],
        observation_required: [
          {
            key: "has_sprout",
            label: "ƒê√£ n·∫£y m·∫ßm?",
            description: "M·∫ßm xu·∫•t hi·ªán",
          },
        ],
      },
      {
        stage_number: 2,
        name: "Ra l√°, b·∫Øt ƒë·∫ßu ph√°t tri·ªÉn c·ªß",
        description: "L√° ph√°t tri·ªÉn, c·ªß b·∫Øt ƒë·∫ßu h√¨nh th√†nh",
        day_start: 11,
        day_end: 25,
        stage_image:
          "https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc",
            description: "T∆∞·ªõi ƒë·ªÅu, kh√¥ng ƒë·ªÉ √∫ng",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "X·ªõi ƒë·∫•t nh·∫π",
            description: "X·ªõi ƒë·∫•t xung quanh g·ªëc",
            frequency: "weekly",
            priority: "medium",
          },
        ],
        observation_required: [
          {
            key: "root_forming",
            label: "C·ªß b·∫Øt ƒë·∫ßu ph·ªìng?",
            description: "Th·∫•y c·ªß nh√¥ l√™n kh·ªèi m·∫∑t ƒë·∫•t",
          },
        ],
      },
      {
        stage_number: 3,
        name: "C·ªß ph√°t tri·ªÉn",
        description: "C·ªß ph√°t tri·ªÉn nhanh",
        day_start: 26,
        day_end: 50,
        stage_image:
          "https://images.unsplash.com/photo-1447175008436-054170c2e979?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc ƒë·ªÅu",
            description: "T∆∞·ªõi ƒë√∫ng l∆∞·ª£ng ƒë·ªÉ c·ªß kh√¥ng b·ªã n·ª©t",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "B√≥n ph√¢n l√¢n kali",
            description: "B·ªï sung dinh d∆∞·ª°ng cho c·ªß",
            frequency: "weekly",
            priority: "medium",
          },
        ],
        observation_required: [
          {
            key: "root_growing",
            label: "C·ªß ƒëang ph√°t tri·ªÉn t·ªët?",
            description: "C·ªß to d·∫ßn, kh√¥ng b·ªã d·ªã d·∫°ng",
          },
        ],
      },
      {
        stage_number: 4,
        name: "Thu ho·∫°ch",
        description: "C·ªß ƒë√£ tr∆∞·ªüng th√†nh",
        day_start: 51,
        day_end: 60,
        stage_image:
          "https://images.unsplash.com/photo-1522184216316-3c25379f9760?w=400",
        autogenerated_tasks: [
          {
            task_name: "Nh·ªï c·ªß",
            description: "Nh·ªï nh·∫π nh√†ng, kh√¥ng l√†m g√£y",
            frequency: "daily",
            priority: "high",
          },
        ],
        observation_required: [
          {
            key: "ready_harvest",
            label: "ƒê·ªß k√≠ch th∆∞·ªõc?",
            description: "C·ªß ƒë·ªß to, m√†u s·∫Øc ƒë·∫πp",
          },
        ],
      },
    ],
    rules: {
      safe_delay_days: 5,
      auto_skip: true,
      warning_days: 2,
    },
    status: "active",
  },
  {
    template_name: "Rau qu·∫£ ng·∫Øn ng√†y",
    plant_group: "fruit_short_term",
    group_description:
      "Template cho d∆∞a leo, c√† chua bi, ·ªõt v√† c√°c lo·∫°i qu·∫£ ng·∫Øn ng√†y 60-90 ng√†y",
    plant_examples: ["D∆∞a leo", "C√† chua bi", "·ªöt chu√¥ng", "D∆∞a chu·ªôt"],
    stages: [
      {
        stage_number: 1,
        name: "N·∫£y m·∫ßm",
        description: "H·∫°t n·∫£y m·∫ßm",
        day_start: 1,
        day_end: 10,
        stage_image:
          "https://images.unsplash.com/photo-1592831746760-85c0a40b19f8?w=400",
        autogenerated_tasks: [
          {
            task_name: "Gi·ªØ ·∫©m",
            description: "Phun s∆∞∆°ng 2-3 l·∫ßn/ng√†y",
            frequency: "daily",
            priority: "high",
          },
        ],
        observation_required: [
          {
            key: "has_sprout",
            label: "ƒê√£ n·∫£y m·∫ßm?",
            description: "M·∫ßm xu·∫•t hi·ªán",
          },
        ],
      },
      {
        stage_number: 2,
        name: "Sinh tr∆∞·ªüng sinh d∆∞·ª°ng",
        description: "C√¢y ph√°t tri·ªÉn th√¢n l√°",
        day_start: 11,
        day_end: 30,
        stage_image:
          "https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc",
            description: "T∆∞·ªõi ƒë·ªÅu ƒë·∫∑n s√°ng chi·ªÅu",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "B√≥n ph√¢n ƒë·∫°m",
            description: "B√≥n ph√¢n cho c√¢y ph√°t tri·ªÉn",
            frequency: "weekly",
            priority: "medium",
          },
          {
            task_name: "D·ª±ng gi√†n",
            description: "D·ª±ng c·ªçc cho c√¢y leo",
            frequency: "weekly",
            priority: "medium",
          },
        ],
        observation_required: [
          {
            key: "strong_plant",
            label: "C√¢y ƒë√£ kh·ªèe?",
            description: "Th√¢n ch·∫Øc, nhi·ªÅu l√°",
          },
        ],
      },
      {
        stage_number: 3,
        name: "Ra hoa, ƒë·∫≠u qu·∫£",
        description: "C√¢y ra hoa v√† b·∫Øt ƒë·∫ßu ƒë·∫≠u qu·∫£",
        day_start: 31,
        day_end: 60,
        stage_image:
          "https://images.unsplash.com/photo-1595855759920-86582396756e?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc ƒë·ªÅu",
            description: "T∆∞·ªõi bu·ªïi s√°ng, tr√°nh √∫ng",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "B√≥n ph√¢n l√¢n kali",
            description: "B√≥n ph√¢n cho qu·∫£",
            frequency: "weekly",
            priority: "high",
          },
          {
            task_name: "Th·ª• ph·∫•n th·ªß c√¥ng",
            description: "D√πngÎ∂ì b√¥ng th·ª• ph·∫•n n·∫øu c·∫ßn",
            frequency: "every_2_days",
            priority: "medium",
          },
        ],
        observation_required: [
          {
            key: "has_flower",
            label: "ƒê√£ ra hoa?",
            description: "C√≥ hoa n·ªü",
          },
          {
            key: "has_fruit",
            label: "ƒê√£ ƒë·∫≠u qu·∫£?",
            description: "Th·∫•y qu·∫£ nh·ªè h√¨nh th√†nh",
          },
        ],
      },
      {
        stage_number: 4,
        name: "Qu·∫£ ph√°t tri·ªÉn v√† thu ho·∫°ch",
        description: "Qu·∫£ l·ªõn d·∫ßn v√† thu ho·∫°ch",
        day_start: 61,
        day_end: 90,
        stage_image:
          "https://images.unsplash.com/photo-1592924357892-91fb0178b2c6?w=400",
        autogenerated_tasks: [
          {
            task_name: "T∆∞·ªõi n∆∞·ªõc",
            description: "T∆∞·ªõi ƒë·ªÅu ƒë·ªÉ qu·∫£ kh√¥ng b·ªã n·ª©t",
            frequency: "daily",
            priority: "high",
          },
          {
            task_name: "Thu ho·∫°ch qu·∫£ ch√≠n",
            description: "H√°i qu·∫£ khi ch√≠n v·ª´a",
            frequency: "every_2_days",
            priority: "high",
          },
        ],
        observation_required: [
          {
            key: "fruit_ripe",
            label: "Qu·∫£ ƒë√£ ch√≠n?",
            description: "M√†u s·∫Øc ƒë·∫πp, k√≠ch th∆∞·ªõc ph√π h·ª£p",
          },
        ],
      },
    ],
    rules: {
      safe_delay_days: 4,
      auto_skip: true,
      warning_days: 2,
    },
    status: "active",
  },
];

async function seedPlantTemplates() {
  try {
    // Connect to MongoDB
    await mongoose.connect(process.env.MONGODB_CONNECTIONSTRING);
    console.log("‚úÖ Connected to MongoDB");

    // Find an expert user to assign as creator
    let expertUser = await User.findOne({ role: "expert" });

    if (!expertUser) {
      // If no expert exists, find admin or create a dummy expert
      expertUser = await User.findOne({ role: "admin" });

      if (!expertUser) {
        console.log("‚ö†Ô∏è  No expert or admin found. Creating dummy expert...");
        const bcrypt = await import("bcrypt");
        const hashedPassword = await bcrypt.hash("Expert@123", 10);

        expertUser = await User.create({
          username: "expert_system",
          email: "expert@farmhub.com",
          password: hashedPassword,
          role: "expert",
          isVerified: true,
        });
        console.log("‚úÖ Created dummy expert user");
      }
    }

    console.log(`üìù Using user: ${expertUser.username} (${expertUser.role})`);

    // Clear existing templates
    const deleteResult = await PlantTemplate.deleteMany({});
    console.log(`üóëÔ∏è  Deleted ${deleteResult.deletedCount} existing templates`);

    // Insert new templates
    const templatesWithCreator = templates.map((template) => ({
      ...template,
      created_by: expertUser._id,
    }));

    const result = await PlantTemplate.insertMany(templatesWithCreator);
    console.log(`‚úÖ Created ${result.length} plant templates`);

    // Display summary
    console.log("\nüìä Summary:");
    result.forEach((template, index) => {
      console.log(`\n${index + 1}. ${template.template_name}`);
      console.log(`   Group: ${template.plant_group}`);
      console.log(`   Stages: ${template.stages.length}`);
      console.log(
        `   Total days: ${Math.max(...template.stages.map((s) => s.day_end))}`
      );
      console.log(`   Examples: ${template.plant_examples.join(", ")}`);
    });

    console.log("\n‚úÖ Seed data created successfully!");
    process.exit(0);
  } catch (error) {
    console.error("‚ùå Error seeding data:", error);
    process.exit(1);
  }
}

seedPlantTemplates();
