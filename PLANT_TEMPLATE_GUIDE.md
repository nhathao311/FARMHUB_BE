# Plant Template System - HÆ°á»›ng dáº«n sá»­ dá»¥ng

## ğŸ“š Tá»•ng quan

PlantTemplate lÃ  há»‡ thá»‘ng máº«u chuáº©n theo nhÃ³m cÃ¢y, giÃºp tá»± Ä‘á»™ng hÃ³a viá»‡c táº¡o checklist, giai Ä‘oáº¡n phÃ¡t triá»ƒn, vÃ  hÆ°á»›ng dáº«n quan sÃ¡t cho ngÆ°á»i dÃ¹ng.

## ğŸ¯ Má»¥c Ä‘Ã­ch

- **KHÃ”NG** dÃ nh cho ngÆ°á»i Ä‘á»c
- DÃ nh cho **mÃ¡y tÃ­nh** (há»‡ thá»‘ng)
- Tá»± Ä‘á»™ng sinh checklist hÃ ng ngÃ y
- TÃ­nh toÃ¡n stage vÃ  tiáº¿n trÃ¬nh
- Cung cáº¥p áº£nh máº«u Ä‘á»ƒ Ä‘á»‘i chiáº¿u

## ğŸŒ± CÃ¡c nhÃ³m cÃ¢y (Plant Groups)

1. **leaf_vegetable** - Rau Äƒn lÃ¡ (xÃ  lÃ¡ch, rau muá»‘ng, cáº£i xanh...)
2. **root_vegetable** - CÃ¢y cá»§ (cÃ  rá»‘t, cá»§ cáº£i...)
3. **fruit_short_term** - Rau/quáº£ ngáº¯n ngÃ y (dÆ°a leo, cÃ  chua...)
4. **fruit_long_term** - CÃ¢y Äƒn quáº£ dÃ i ngÃ y (cam, chanh...)
5. **bean_family** - Há» Ä‘áº­u (Ä‘áº­u Ä‘Å©a, Ä‘áº­u HÃ  Lan...)
6. **herb** - CÃ¢y gia vá»‹ (hÃºng quáº¿, rau mÃ¹i...)
7. **flower_vegetable** - Rau Äƒn hoa (sÃºp lÆ¡, bÃ´ng cáº£i...)
8. **other** - KhÃ¡c

## ğŸ“¦ Cáº¥u trÃºc PlantTemplate

### 1. ThÃ´ng tin cÆ¡ báº£n

```javascript
{
  template_name: "Rau Äƒn lÃ¡ cÆ¡ báº£n",
  plant_group: "leaf_vegetable",
  group_description: "MÃ´ táº£ vá» nhÃ³m cÃ¢y",
  plant_examples: ["XÃ  lÃ¡ch", "Rau muá»‘ng", "Cáº£i xanh"],
  status: "active" // draft, active, archived
}
```

### 2. Stages (Giai Ä‘oáº¡n phÃ¡t triá»ƒn)

Má»—i template cÃ³ 3-6 stages:

```javascript
{
  stage_number: 1,
  name: "Náº£y máº§m",
  description: "Giai Ä‘oáº¡n háº¡t náº£y máº§m",
  day_start: 1,
  day_end: 7,
  stage_image: "/uploads/stages/sprout.jpg",

  // Checklist tá»± Ä‘á»™ng sinh
  autogenerated_tasks: [
    {
      task_name: "Giá»¯ áº©m Ä‘áº¥t",
      description: "Phun sÆ°Æ¡ng 2 láº§n/ngÃ y",
      frequency: "daily",
      illustration_image: "/uploads/tasks/watering.jpg",
      priority: "high"
    }
  ],

  // Äiá»u kiá»‡n quan sÃ¡t (Yes/No)
  observation_required: [
    {
      key: "has_sprout",
      label: "ÄÃ£ náº£y máº§m?",
      description: "Máº§m cao khoáº£ng 1-2cm"
    }
  ]
}
```

### 3. Rules (Quy táº¯c xá»­ lÃ½ trá»…)

```javascript
{
  rules: {
    safe_delay_days: 3,    // Cho phÃ©p trá»… 3 ngÃ y
    auto_skip: true,       // Tá»± Ä‘á»™ng skip náº¿u quÃ¡ trá»…
    warning_days: 1        // Cáº£nh bÃ¡o khi trá»… 1 ngÃ y
  }
}
```

## ğŸš€ CÃ¡ch sá»­ dá»¥ng cho Expert

### BÆ°á»›c 1: Truy cáº­p PlantTemplate Manager

1. ÄÄƒng nháº­p vá»›i tÃ i khoáº£n **expert**
2. VÃ o **Expert Home**
3. Click **"ğŸŒ± Templates"**

### BÆ°á»›c 2: Táº¡o Template má»›i

1. Click **"Táº¡o Template Má»›i"**
2. Äiá»n thÃ´ng tin cÆ¡ báº£n:
   - TÃªn template
   - Chá»n nhÃ³m cÃ¢y
   - MÃ´ táº£
   - Danh sÃ¡ch vÃ­ dá»¥ cÃ¢y

### BÆ°á»›c 3: ThÃªm Stages

Cho má»—i stage:

- Sá»‘ thá»© tá»± (1, 2, 3...)
- TÃªn giai Ä‘oáº¡n (Náº£y máº§m, Ra lÃ¡ tháº­t...)
- Khoáº£ng ngÃ y (day_start - day_end)
- Upload áº£nh máº«u
- ThÃªm checklist tá»± Ä‘á»™ng
- ThÃªm Ä‘iá»u kiá»‡n quan sÃ¡t

### BÆ°á»›c 4: Cáº¥u hÃ¬nh Rules

- Sá»‘ ngÃ y cho phÃ©p trá»…
- CÃ³ tá»± Ä‘á»™ng skip khÃ´ng?
- Sá»‘ ngÃ y cáº£nh bÃ¡o

### BÆ°á»›c 5: KÃ­ch hoáº¡t

- LÆ°u dáº¡ng **draft** Ä‘á»ƒ xem láº¡i
- Click **"KÃ­ch hoáº¡t"** khi sáºµn sÃ ng

## ğŸ”— API Endpoints

### Táº¡o template

```
POST /api/plant-templates
Authorization: Bearer <token>
Body: { template_name, plant_group, stages, ... }
```

### Láº¥y danh sÃ¡ch

```
GET /api/plant-templates?plant_group=leaf_vegetable&status=active
```

### Láº¥y theo ID

```
GET /api/plant-templates/:id
```

### Láº¥y theo nhÃ³m cÃ¢y

```
GET /api/plant-templates/group/:plantGroup
```

### Cáº­p nháº­t

```
PUT /api/plant-templates/:id
Body: { ...updateData }
```

### XÃ³a (soft delete)

```
DELETE /api/plant-templates/:id
```

### KÃ­ch hoáº¡t

```
PATCH /api/plant-templates/:id/activate
```

### Láº¥y stage theo ngÃ y

```
GET /api/plant-templates/:id/stage/:day
```

## ğŸ“Š CÃ¡ch há»‡ thá»‘ng sá»­ dá»¥ng Template

### 1. Sinh Daily Checklist

Má»—i ngÃ y, há»‡ thá»‘ng:

1. Kiá»ƒm tra ngÃ y hiá»‡n táº¡i cá»§a cÃ¢y
2. TÃ¬m stage tÆ°Æ¡ng á»©ng
3. Láº¥y `autogenerated_tasks` tá»« stage
4. Táº¡o DailyTasks dá»±a trÃªn `frequency`

### 2. TÃ­nh Stage hiá»‡n táº¡i

Dá»±a vÃ o:

- NgÃ y trá»“ng (planted_date)
- Sá»‘ ngÃ y hiá»‡n táº¡i
- Quan sÃ¡t cá»§a user (`observation_required`)
- Rules vá» trá»… háº¡n

### 3. TÃ­nh pháº§n trÄƒm tiáº¿n trÃ¬nh

```javascript
// CÃ´ng thá»©c Ä‘Æ¡n giáº£n
progress = ((current_stage - 1) / total_stages) * 100;

// NÃ¢ng cao: tÃ­nh theo hoÃ n thÃ nh checklist
stage_progress = (completed_tasks / total_tasks) * (100 / total_stages);
```

### 4. Hiá»ƒn thá»‹ áº£nh Ä‘á»‘i chiáº¿u

- User chá»¥p áº£nh cÃ¢y cá»§a mÃ¬nh
- Há»‡ thá»‘ng hiá»ƒn thá»‹ `stage_image` bÃªn cáº¡nh
- User so sÃ¡nh vÃ  tick quan sÃ¡t

## ğŸ’¡ Best Practices

### Khi táº¡o Template:

1. **Chá»n nhÃ³m cÃ¢y chÃ­nh xÃ¡c**: CÃ¢y cÃ¹ng nhÃ³m cÃ³ chu ká»³ tÆ°Æ¡ng tá»±
2. **Khoáº£ng ngÃ y realistic**: Dá»±a trÃªn kinh nghiá»‡m thá»±c táº¿
3. **áº¢nh rÃµ rÃ ng**: áº¢nh máº«u pháº£i dá»… nháº­n biáº¿t
4. **Checklist Ä‘á»§ chi tiáº¿t**: KhÃ´ng quÃ¡ nhiá»u, khÃ´ng quÃ¡ Ã­t
5. **Observation Ä‘Æ¡n giáº£n**: CÃ¢u há»i Yes/No, dá»… tráº£ lá»i

### Khi quáº£n lÃ½ Template:

1. **Version control**: TÄƒng version khi cáº­p nháº­t
2. **Test trÆ°á»›c khi activate**: LÆ°u draft, kiá»ƒm tra ká»¹
3. **Monitor usage**: Xem `usage_count` Ä‘á»ƒ biáº¿t template nÃ o phá»• biáº¿n
4. **Update Ä‘á»‹nh ká»³**: Cáº­p nháº­t dá»±a trÃªn feedback

## ğŸ”„ Workflow tá»•ng thá»ƒ

```
User táº¡o Notebook
  â†’ Chá»n Guide
    â†’ Guide cÃ³ plant_group
      â†’ Há»‡ thá»‘ng tÃ¬m PlantTemplate tÆ°Æ¡ng á»©ng
        â†’ Sinh DailyTasks tá»« autogenerated_tasks
        â†’ TÃ­nh stage dá»±a trÃªn ngÃ y
        â†’ Hiá»ƒn thá»‹ áº£nh máº«u
        â†’ User tick observation
        â†’ Chuyá»ƒn stage tá»± Ä‘á»™ng
        â†’ TÃ­nh progress %
```

## ğŸ“ VÃ­ dá»¥ Template hoÃ n chá»‰nh

```json
{
  "template_name": "Rau Äƒn lÃ¡ cÆ¡ báº£n",
  "plant_group": "leaf_vegetable",
  "group_description": "Template cho cÃ¡c loáº¡i rau Äƒn lÃ¡ nhÆ° xÃ  lÃ¡ch, rau muá»‘ng, cáº£i xanh",
  "plant_examples": ["XÃ  lÃ¡ch", "Rau muá»‘ng", "Cáº£i xanh", "Rau dá»n"],
  "stages": [
    {
      "stage_number": 1,
      "name": "Náº£y máº§m",
      "description": "Háº¡t náº£y máº§m, máº§m vÆ°Æ¡n lÃªn",
      "day_start": 1,
      "day_end": 7,
      "stage_image": "/uploads/leaf_veg/stage1.jpg",
      "autogenerated_tasks": [
        {
          "task_name": "Giá»¯ áº©m",
          "description": "Phun sÆ°Æ¡ng 2 láº§n/ngÃ y",
          "frequency": "daily",
          "priority": "high"
        }
      ],
      "observation_required": [
        {
          "key": "has_sprout",
          "label": "ÄÃ£ náº£y máº§m?",
          "description": "Máº§m cao 1-2cm"
        }
      ]
    },
    {
      "stage_number": 2,
      "name": "Ra lÃ¡ tháº­t",
      "description": "LÃ¡ tháº­t Ä‘áº§u tiÃªn xuáº¥t hiá»‡n",
      "day_start": 8,
      "day_end": 14,
      "stage_image": "/uploads/leaf_veg/stage2.jpg",
      "autogenerated_tasks": [
        {
          "task_name": "TÆ°á»›i nÆ°á»›c",
          "frequency": "daily",
          "priority": "high"
        },
        {
          "task_name": "Kiá»ƒm tra sÃ¢u bá»‡nh",
          "frequency": "every_2_days",
          "priority": "medium"
        }
      ],
      "observation_required": [
        {
          "key": "has_true_leaf",
          "label": "ÄÃ£ cÃ³ lÃ¡ tháº­t?",
          "description": "2-3 lÃ¡ tháº­t Ä‘áº§u tiÃªn"
        }
      ]
    },
    {
      "stage_number": 3,
      "name": "Sinh trÆ°á»Ÿng",
      "description": "CÃ¢y phÃ¡t triá»ƒn máº¡nh",
      "day_start": 15,
      "day_end": 30,
      "stage_image": "/uploads/leaf_veg/stage3.jpg",
      "autogenerated_tasks": [
        {
          "task_name": "TÆ°á»›i nÆ°á»›c",
          "frequency": "daily",
          "priority": "high"
        },
        {
          "task_name": "BÃ³n phÃ¢n",
          "frequency": "weekly",
          "priority": "medium"
        }
      ],
      "observation_required": [
        {
          "key": "strong_growth",
          "label": "CÃ¢y Ä‘Ã£ phÃ¡t triá»ƒn máº¡nh?",
          "description": "Nhiá»u lÃ¡, thÃ¢n xanh tá»‘t"
        }
      ]
    },
    {
      "stage_number": 4,
      "name": "Thu hoáº¡ch",
      "description": "ÄÃ£ cÃ³ thá»ƒ thu hoáº¡ch",
      "day_start": 31,
      "day_end": 40,
      "stage_image": "/uploads/leaf_veg/stage4.jpg",
      "autogenerated_tasks": [
        {
          "task_name": "Thu hoáº¡ch",
          "frequency": "daily",
          "priority": "high"
        }
      ],
      "observation_required": [
        {
          "key": "ready_to_harvest",
          "label": "ÄÃ£ sáºµn sÃ ng thu hoáº¡ch?",
          "description": "LÃ¡ Ä‘á»§ lá»›n, xanh tá»‘t"
        }
      ]
    }
  ],
  "rules": {
    "safe_delay_days": 3,
    "auto_skip": true,
    "warning_days": 1
  },
  "status": "active"
}
```

## ğŸ“ LÆ°u Ã½ quan trá»ng

1. **Template â‰  Guide**

   - Template: Cho mÃ¡y tÃ­nh
   - Guide: Cho ngÆ°á»i Ä‘á»c

2. **Má»™t nhÃ³m cÃ¢y = Má»™t template**

   - KhÃ´ng táº¡o template riÃªng cho tá»«ng loáº¡i cÃ¢y
   - Gom nhá»¯ng cÃ¢y cÃ³ chu ká»³ tÆ°Æ¡ng tá»±

3. **Stage pháº£i liÃªn tá»¥c**

   - stage_number: 1, 2, 3, 4...
   - KhÃ´ng Ä‘Æ°á»£c nháº£y sá»‘

4. **NgÃ y pháº£i há»£p lÃ½**

   - day_end cá»§a stage nÃ y = day_start - 1 cá»§a stage sau
   - Hoáº·c cÃ³ khoáº£ng trá»‘ng há»£p lÃ½

5. **Test ká»¹ trÆ°á»›c khi deploy**
   - Táº¡o draft
   - Test vá»›i notebook tháº­t
   - Kiá»ƒm tra checklist sinh ra Ä‘Ãºng khÃ´ng
   - Má»›i activate

## ğŸ†˜ Troubleshooting

### Template khÃ´ng táº¡o Ä‘Æ°á»£c?

- Kiá»ƒm tra stage_number cÃ³ liÃªn tá»¥c khÃ´ng
- Kiá»ƒm tra day_start/day_end há»£p lÃ½
- Äáº£m báº£o cÃ³ Ã­t nháº¥t 3 stages

### Checklist khÃ´ng sinh ra?

- Kiá»ƒm tra `frequency` Ä‘Ãºng enum chÆ°a
- Kiá»ƒm tra stage cÃ³ `autogenerated_tasks` chÆ°a

### Stage khÃ´ng chuyá»ƒn tá»± Ä‘á»™ng?

- Kiá»ƒm tra rules
- Kiá»ƒm tra observation_required
- Xem log há»‡ thá»‘ng

---

Náº¿u cáº§n há»— trá»£ thÃªm, liÃªn há»‡ Ä‘á»™i ngÅ© phÃ¡t triá»ƒn! ğŸŒ±
